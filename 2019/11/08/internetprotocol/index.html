
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>网络协议 - Hexo</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Kritons,"> 
    <meta name="description" content="网络协议的系统概述以及其要点，涵盖相关协议的原理，应用以及其部分实施的原理和其具体的步骤，其中还包含了自己对网络协议的相关理解跟见解等。
TCP/IP概述要点
IP（Internet Protoco,"> 
    <meta name="author" content="kritons"> 
    <link rel="alternative" href="atom.xml" title="Hexo" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>

<body class="loading">
    <span id="config-title" style="display:none">Hexo</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" target="_blank" rel="noopener" data-url="http://yoursite.com"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">网络协议</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" target="_blank" rel="noopener" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;" target="_blank" rel="noopener"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">网络协议</h1>
        <div class="stuff">
            <span>十一月 08, 2019</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/TC-IP%E5%8D%8F%E8%AE%AE%E7%B0%87/" rel="tag">TC/IP协议簇</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B/" rel="tag">网络工程</a></li></ul>


        </div>
        <div class="content markdown">
            <h3 id="网络协议的系统概述以及其要点，涵盖相关协议的原理，应用以及其部分实施的原理和其具体的步骤，其中还包含了自己对网络协议的相关理解跟见解等。"><a href="#网络协议的系统概述以及其要点，涵盖相关协议的原理，应用以及其部分实施的原理和其具体的步骤，其中还包含了自己对网络协议的相关理解跟见解等。" class="headerlink" title="网络协议的系统概述以及其要点，涵盖相关协议的原理，应用以及其部分实施的原理和其具体的步骤，其中还包含了自己对网络协议的相关理解跟见解等。"></a>网络协议的系统概述以及其要点，涵盖相关协议的原理，应用以及其部分实施的原理和其具体的步骤，其中还包含了自己对网络协议的相关理解跟见解等。</h3><hr>
<h2 id="TCP-IP概述要点"><a href="#TCP-IP概述要点" class="headerlink" title="TCP/IP概述要点"></a>TCP/IP概述要点</h2><ul>
<li>IP（Internet Protocol）可以屏蔽底层物理的各种各样的差异，向上提供一致性。</li>
<li>网络协议的分层：<img src="/photos/tcp.png" alt="网络协议的分层"></li>
<li>网络协议大致可分为：硬件层，网络接口层，IP层，传输层，应用层。其中IP层和网络接口层为IP地址和物理地址的分界；应用层和传输层为操作系统内外部的分界。</li>
<li>IP层和网络接口层为点到点传输，传输层和应用层为端到端传输。</li>
<li>协议依赖：</li>
<li>多路复用：TCP，UCP构建于IP之上，各类应用构建于TCP，UDP之上，所以不同的应用会复用TCP或者UDP，而TCP，UDP会复用IP，所以多路复用体现于协议的所有层次。多路分解则相反。</li>
</ul>
<hr>
<h2 id="PPP（Point-to-Point-Protocol）"><a href="#PPP（Point-to-Point-Protocol）" class="headerlink" title="PPP（Point to Point Protocol）"></a>PPP（Point to Point Protocol）</h2><ul>
<li>PPP链路的建立，发起方通过电话网络呼叫回应方，呼叫成功后建立起一条物理链接，之后双方利用LCP建立PPP链路，然后用PAP或者CHAP验证客户身份，最后用IPCP配置IP地址。通信完成后双方利用LCP断开PPP链路，之断开物理链接。</li>
</ul>
<hr>
<h2 id="Internet地址解析"><a href="#Internet地址解析" class="headerlink" title="Internet地址解析"></a>Internet地址解析</h2><ul>
<li>IP地址空间范围从0.0.0.0到255.255.255.255，包括2的32次方个地址，这些地址分为5类：<ol>
<li>A类地址：首比特为0，1.0.0.0~126.255.255.255，适用于超级大网</li>
<li>B类地址：前2个比特为10，128.0.0.0~191.255.255.255，适用于中规模网络</li>
<li>C类地址：前3个比特为110,192.0.0.0~223.255.255.255,适用于小规模网络</li>
<li>D类地址：前4个比特为1110，224.0.0.0~239.255.255.255 组播地址</li>
<li>E类地址：前5个比特为11110，240.0.0.0~247.255.255.255 保留</li>
<li>首个字节为127的地址回送地址，常用的回送地址为127.0.0.1</li>
</ol>
</li>
<li>ARP(Address Resolution Protocol)协议的思想，步骤以及跨物理网络的地址解析：<ul>
<li>思想：广播询问，单播回应</li>
<li>步骤：如果A要发送数据给B，那么A会发送一个广播请求，询问谁的IP地址是B，请求获取B的物理地址，所有物理网络上的主机都会收到广播，只有B做出回应，把自己的物理地址告诉A。</li>
<li>跨物理网络的地址解析：如果A要发送地址给B，A通过B的网络号判断B是否为同一网段，如果非同一网段，则发送给其相邻的路由器，即利用ARP协议获取路由器接口地址，其目标的IP地址为B，物理地址为路由器接口物理地址，到达路由器后，路由器利用相同的方法发送给B。</li>
</ul>
</li>
<li>ARP提高通信效率的措施：<ol>
<li>各主机设置ARP缓存</li>
<li>各主机请求获取物理地址是，写入自己的IP/MAC关系</li>
<li>主机联网时广播自己的IP/MAC关系</li>
</ol>
</li>
<li><strong>ARP欺骗</strong>：<ul>
<li>嗅探器 ：利用嗅探获取网络中的通信数据。</li>
<li>基于ARP欺骗的会话劫持：假如网络中2台主机A和B要通信，有一台主机要嗅探他们之间的数据，H先向A发送一个ARP应答报文，其中包含IPb/MACh的映射，A更新自己的ARP缓存；随后H向B发送一个ARP应答报文，其中包括IPa/MACh的映射，B更新自己的ARP缓存，鉴于ARP缓存会定更新，H只要以较小于更新时间频率发送ARP欺骗报文就可以持续嗅探A和B之间的通信报文。</li>
<li>预防：使用静态缓存，在DOS上指定IP和MAC地址，或者使用ARP防欺骗工具等以及对数据加密。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="IP（Internet-Protocol）"><a href="#IP（Internet-Protocol）" class="headerlink" title="IP（Internet Protocol）"></a>IP（Internet Protocol）</h2><ul>
<li>IP数据报的特点<ul>
<li>提供了一种无连接的传递机制（不建立链接，各数据报可能通过不同路径传递）</li>
<li>不保证数据报传输的可靠性（不纠错，不报告）</li>
<li>尽最大努力投递机制（不轻易丢弃数据报）</li>
</ul>
</li>
<li>IP数据报的格式：<img src="/photos/ip.png" alt="IP数据报格式"></li>
<li>IP数据报的分片和重组：<ul>
<li>IP数据报首部标志字段：0（保留吗），1（DF：0可分片；1不可分片；），2（MF：0，最后一个分片；1不是最后一个分片），若DF为0，且数据报大于MTU值，则丢弃。</li>
<li>IP数据报要求各分片按一个物理帧发送，切偏位移为8的整数倍。</li>
<li>分片地点为信宿机而非路由器等中间机器：1.减少路由器负担；2.避免重复分片;3.每个分片可独自选路。</li>
<li>重组：DF为1为单个数据报，为0为分片，利用如FreeBSD算法将数据报重组，设置超时定时器，若在规定时间内未收到全部分片则丢失整个数据报。</li>
<li>FreeBSD算法：基于”洞”的算法，首先为数据报分配一片缓冲区，然后接收的每个分片填入缓冲区。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ICMP-Internet-Control-Message-Protocol"><a href="#ICMP-Internet-Control-Message-Protocol" class="headerlink" title="ICMP(Internet Control Message Protocol)"></a>ICMP(Internet Control Message Protocol)</h2><ul>
<li>ICMP协议解决的问题有：<ul>
<li>解决配置错误造成的回路，设置TTL字段，每进过一个路由器减1，到0时丢弃报文。</li>
<li>分片重组时报文丢失,设置超时定时器，超时时丢弃报文。</li>
<li>路由器找不到目的地。</li>
</ul>
</li>
<li>差错报告类报文：<ol>
<li>其数据区包含发送差错的IP数据报首部以及数据区前64bit（此包含了错误信息）</li>
<li>仅向源端报告差错，不向中间路由器报告</li>
<li>携带ICMP差错报文发生差错时，不会生成ICMP报文</li>
<li>应由于分片报文时，仅对第一个分片生成报文</li>
</ol>
<ul>
<li>目的站不可达报文：代码字段给出原因</li>
<li>超时报文：（TTL超时，代码字段为0；重组超时，代码字段为1）</li>
<li>参数错误报文：（无法应用上述2个报文解释的报文，其报文指针指向发送差错的第一个字段）</li>
</ul>
</li>
<li>请求应带报文（用于测试网络联通性）：<ul>
<li>类型：8-&gt;会送请求；0-&gt;会送应带</li>
<li>标识和序号用于匹配报文</li>
</ul>
</li>
<li>地址掩码请求和应答报文（主机为得知本网络地址掩码，向路由器发送报文，若不知道路由器地址则广播）<ul>
<li>类型：17-&gt;请求；18-&gt;应答</li>
</ul>
</li>
<li><strong>UDP-Lite</strong>：将数据分为敏感区和非敏感区，当所有数据均为非敏感区时，UDP-Lite = UDP报文。</li>
</ul>
<hr>
<h2 id="UDP-User-Datagram-Protocol"><a href="#UDP-User-Datagram-Protocol" class="headerlink" title="UDP(User Datagram Protocol)"></a>UDP(User Datagram Protocol)</h2><hr>
<h2 id="TCP（Transmission-Control-Protocol）"><a href="#TCP（Transmission-Control-Protocol）" class="headerlink" title="TCP（Transmission Control Protocol）"></a>TCP（Transmission Control Protocol）</h2><ul>
<li>TCP协议为端到端，面向链接，提供可靠性的传输协议。<ol>
<li>面向数据流，与应用程序接收到的bit流一致（以字节为单位）</li>
<li>虚电路链接：传输之前开始交互确认</li>
<li>有缓冲的传输：双方设置缓冲区，数据量较小的时候使用推push操作</li>
<li>无结构数据流服务：不提供结构数据流</li>
<li>全双工连接：双方都可以同时接发收数据</li>
</ol>
</li>
<li><strong>TCP链接建立：三次握手建立链接</strong><ol>
<li>客户端发送SYN（报文段），指明客户端的端口以及初始序号ISM（seq=x）</li>
<li>服务器端收到后发送服务器的初始序号ISN（seq=y）的SYN报文段应答，并且包含ACK（确认信息）。确认序号为客户端的ISN+1（x+1），表示已收到报文</li>
<li>客户端收到报文后，发送确认序号为ISN（y+1）的报文段，对服务器确认已经收到报文，并表示成功建立链接</li>
</ol>
</li>
<li>TCP三次握手完成的功能有：<ol>
<li>同意链接</li>
<li>协商各报文字段的初始ISN序号（<strong>ISN规定不为1，防止IP欺骗</strong>）</li>
<li>协商最大报文字段</li>
</ol>
</li>
<li>三次握手建立连接可协商MSS（最大报文字段），并根据MSS设置缓存区，提高效率，在局域网中，可放入每一帧，从而充分利用带宽，使之与网络中的MTU相适应（一般最小的MTU为MSS）MSS</li>
<li><strong>TCP链接断开:四次握手断开链接</strong><ol>
<li>网点1数据接收完成后，发送一个FIN报文，ISN（seq=x）</li>
<li>网点2收到FIN报文后，发送一个ACK报文，ISN（seq=x+1）</li>
<li>网点2通知应用程序再无数据流入，关闭链接，发送FIN报文给网点1，ISN（seq=y）</li>
<li>网点1收到FIN报文后，发送ACK报文，ISN（seq=y+1）</li>
</ol>
<ul>
<li>（由于为全双工链接，所以双方必须关闭其自己的链接）</li>
</ul>
</li>
<li>TCP可提供半封闭功能，第二步后，网点2仍可发送数据，网点1可会ACK报文确认。</li>
<li>TCP的连接异常关闭：发送端发送一个RST报文段此时双方关闭连接并释放缓存区。</li>
<li>TCP的半开连接检测：TCP引入保活定时器，若一段时间客户端无响应，则发送探察报文有响应则重置计时器，无响应则关闭计时器。</li>
<li><strong>SYN洪范攻击：</strong>利用半完成的半开连接，大量主机占用服务器资源</li>
<li>与UDP相似，TCP允许一台机器上多个应用程序同时进行通信，并且使用端口号标识进程，但是TCP是面向连接的协议而不是对应端口，而是一条虚链路，所以TCP用端点（IP，端口号）来标识以连接。</li>
<li>防丢失：发送方发送报文后会保存一段记录，并启动计时器，如果在一段时间内未收到ACK报文则认为丢失，进行重传操作（根据RTT（往返时间调整计时器））</li>
<li>防重复及乱序：对报文进行编号，接收方会记住序号，即ISN，由双方协定，体现了面向数据流的特征（n+1报文序号=n报文序号+n报文长度），以字节计。</li>
<li>自适应重传算法以及改进后的算法：Karn算法和定时器补偿</li>
<li>TCP 滑动窗口：与ICMP（IPsec）等协议不同的是其滑动窗口不是按报文段而是字节来滑动<ul>
<li>利用滑动窗口实现端到端的流量控制，根据其接收方的缓冲区大小来调节发送方的滑动窗口。</li>
</ul>
</li>
<li>TCP糊涂窗口综合征 </li>
</ul>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="http://domain.com/awesome.mp3">
            </audio>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
